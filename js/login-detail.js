$(function(){var u=null,g=/\d{17,}.jpg/g,e=location.search.split("=")[1],i=0;function a(s){console.log(s),$(".h_inner>em").text(s.product.name);for(var i,a,t,c=s.product.descr.length,r=0;r<c;r++)i=(a=s.product.descr[r]).resource,t=a.rawResource,1==a.type?$(".c_d_inner").append("<p>"+i+"</p>"):$(".c_d_inner").append('<img src="./images/'+t+'.jpg">');var e="",l="",n="",o=u.product.skus,p=u.coupons,d=u.product.picUrls;for(r=0;r<d.length;r++){e+='<li><img src="./images/'+d[r].match(g)+'"></li>'}for(r=0;r<o.length;r++)o[r].attrs.length&&(l+="<li>"+o[r].attrs[0].attrValue+"</li>");l&&(l='<div class="y_s clearfix mg"><div class="title_c">颜色: </div><ul class="s_c">'+l+"</ul></div>"),p.length&&(n='<div class="title_c">促销: </div><ul class="y_h"><li><span class="label">'+p[0].couponLabel+'</span><span class="">10元&nbsp;&nbsp;'+p[0].couponName+',&nbsp;&nbsp;无门槛&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="get">领券</span></li></ul></div>');var m='<span class="l_arrow"></span><span class="r_arrow"></span><div class="magnify"><div class="s-mask"></div><img src="./images/'+s.product.picIds[0]+'.jpg" alt="" class="s_img"></div><div class="tip_img"><ul>'+e+'<div class="uvoid"></div></ul></div><div class="max_img"><img src="./images/'+s.product.picIds[0]+'.jpg" alt="" class="m_img"></div><div class="get_detail"><h2 class="h_inner g_title"><em>'+s.product.name+'</em></h2><p class="point">'+s.product.suggestWord+'</p><p class="price"><span class="rmb">￥</span><span class="n_price">'+s.product.skus[0].spePrice+'</span><span class="d_price">￥'+s.product.skus[0].price+'</span></p><div class="c_x clearfix mg">'+n+l+'<div class="change_num clearfix mg"><div class="title_c">数量: </div><div class="input"><span class="down"></span><input type="text" value="1" id="car_num"><span class="up"></span></div></div><div class="f_w clearfix mg"><div class="title_c">服务: </div><a href="javascript:;" class="server"><i></i>满119包邮</a><a href="javascript:;" class="server"><i></i>商家发货</a><a href="javascript:;" class="server"><i></i>网易自营</a></div><p class="btn"><a href="javascript:;" class="now">立即购买</a><a href="javascript:;" class="put_in"><i></i>加入购物车</a></p></div></div>';$("#main").html(m),v(),$(".tip_img>ul>li:first").css("borderColor","#d33a31")}function t(){var l=$(".magnify").outerWidth(),n=$(".magnify").outerHeight(),o=$(".s-mask").outerWidth(),p=$(".s-mask").outerHeight();$(".magnify").on("mouseover",function(){$(".s-mask").css("display","block"),$(".max_img").css("display","block"),$(this).on("mousemove",function(s){var i=s.pageX-$(this).offset().left,a=s.pageY-$(this).offset().top,t=i-parseInt(o/2),c=a-parseInt(p/2),r=parseInt(t/l*$(".m_img").outerWidth()),e=parseInt(c/n*$(".m_img").outerHeight());t<0&&(r=t=0),l-o<t&&(t=l-o,r=parseInt(t/l*$(".m_img").outerWidth())),c<0&&(e=c=0),n-p<c&&(c=n-p,e=parseInt(c/n*$(".m_img").outerHeight())),$(".s-mask").css({top:c,left:t}),$(".m_img").css({top:-e,left:-r})})}),$(".magnify").on("mouseout",function(){$(".s-mask").removeAttr("style"),$(".max_img").removeAttr("style")})}window.onscroll=function(){var s=document.documentElement.scrollTop||document.body.scrollTop;900<=s&&0==i?($("body").append('<div class="top_fix"><div class="container fix_inner clearfix"><div class="fix_l"><img src="./images/'+u.product.picIds[0]+'.jpg"></div><div class="fix_c"><p class="f_c_tip">'+u.product.name+'</p><span class="f_price">'+u.product.skus[0].spePrice+'</price></div><div class="fix_r"><a href="javascript:;" class="now">立即购买</a><a href="javascript:;" class="put_in"><i></i>加入购物车</a></div></div>'),i=1):s<=900&&1==i&&($(".top_fix").remove(),i=0)},$.get("./json/detail.json?v="+Math.random(),function(s){for(var i=0;i<s.length;i++)if(e==s[i].product.id){a(u=s[i]),t(),$(".s_c li").click(function(){var s=$(this).index(),i=u.product.picIds[s];if(s!=r){l=0,$(".s_c li").eq(r).removeAttr("style"),r=s;var a="",t=u.product.skus[s].picUrl.match(g);$(".s_img").attr({src:"./images/"+i+".jpg"});for(var c=0;c<t.length;c++)a+='<li><img src="./images/'+t[c]+'"></li>';$(".uvoid").removeAttr("style").unbind().siblings().unbind(),$(".tip_img .uvoid").html(a).siblings().css("display","none"),v(),$(".uvoid>li:first").css("borderColor","#d33a31"),$(".m_img").attr({src:"./images/"+i+".jpg"})}else l=!l,$(".uvoid").toggle().siblings().toggle();l?$(this).removeAttr("style"):$(this).css("borderColor","#d33a31")}),$(".put_in").click(function(){var s=$(".s_c li");if(s.length)for(var i=0;i<s.length;i++){if("rgb(211, 58, 49)"==$(s[i]).css("borderColor")){o=$(s[i]).html(),c(i);break}$(".msgcode").html("请先选择款式 ！").css("display","block"),setTimeout(function(){$(".msgcode").html("").removeAttr("style")},1e3)}else c()}),$(".cnum").html(p()),$(".up").click(function(){var s=$(this).prev().val();s++,$(this).prev().val(s)}),$(".down").click(function(){var s=$(this).next().val();1<s&&s--,$(this).next().val(s)}),$("#car_num").on("input",function(){var s=$(this).val();3<=s.length&&(s=s.substr(0,3)),/^\d{1,3}$/g.test(s)&&!(s<1)&&s||(s=1),$(this).val(s)});break}},"json"),$($.get("./json/recommend.json?v="+Math.random(),function(s){for(var i,a,t,c,r,e,l,n=s.data.hotProduct,o=0;o<4;o++)l=n[o].productId,t=n[o].products.tags,c=n[o].products.couponLabelDesc,r=n[o].products.minPrice,e=n[o].products.originalCost,null!==c&&(i="inline",a=c),null==c&&""==t&&(i="none"),null==c&&""!==t&&(i="inline",a=t),$("#rec-list").append('<div class="product"><a  class="p-inner link" data="'+l+'"><img src="./images/'+n[o].products.coverIdStr+'.jpg" alt=""></a><div class="detail"><h3><span class="tags" style="display:'+i+'"><em>'+a+'</em></span><a  class="p-name link" data="'+l+'">'+n[o].products.name+"</a></h3><p>¥<em>"+r+"</em></p></div> "),r!==e&&$($("#rec-list .p-inner")[o]).append('<span class="discount"><i class="m-p">&yen;'+r+'</i><i class="dis">&yen;'+e+"</i></span>");$("#rec-list .link").on("click",function(){var s=$(this).attr("data");window.open("./detail.html?id="+s,"_blank")})},"json"));var r=null,l=0;function v(){$(".tip_img>ul li").on("click",function(){var s=$(this).children("img").attr("src");$(".s_img").attr({src:s}),$(".m_img").attr({src:s}),$(this).css("borderColor","#d33a31").siblings("li").removeAttr("style")})}var n=0,o="";function c(s){s=s||0;var i=[],a=parseInt($("#car_num").val()),t=u.product.skus[s].id;localStorage.cartList||(localStorage.cartList=JSON.stringify(i)),i=JSON.parse(localStorage.cartList);for(var c=0;c<i.length;c++){if(i[c].id==t){i[c].num+=a,localStorage.cartList=JSON.stringify(i),n=0;break}n=1}if(n||!i.length){var r={id:t,color:o,price:parseInt(u.product.skus[s].spePrice),title:u.product.name,num:a,src:"./images/"+u.product.picIds[s]+".jpg",checked:"checked",href:e};i.push(r),localStorage.cartList=JSON.stringify(i)}return $("#car_num").val(1),$(".cnum").html(p(i)),$(".msgcode").html("添加购物车成功 ！").css("display","block"),setTimeout(function(){$(".msgcode").html("").removeAttr("style")},1e3),i}function p(s){var i=0;if(s=s||JSON.parse(!!localStorage.cartList&&localStorage.cartList))for(var a=0;a<s.length;a++)i+=s[a].num;return i}});